// Prisma

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

// Modelo de Usuário
model User {
  id                String    @id @default(cuid())
  email             String    @unique
  name              String?
  password          String
  plan              Plan      @default(START)
  emailVerified     Boolean   @default(false)
  emailVerifiedAt   DateTime?
  twoFactorEnabled  Boolean   @default(false)
  twoFactorSecret   String?
  lastLoginAt       DateTime?
  loginAttempts     Int       @default(0)
  lockedUntil       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  gifts             Gift[]
  subscription      Subscription?
  verificationTokens VerificationToken[]
  passwordResetTokens PasswordResetToken[]
  sessions          Session[]
}

// Modelo de Token de Verificação de Email
model VerificationToken {
  id          String    @id @default(cuid())
  token       String    @unique
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt   DateTime
  createdAt   DateTime  @default(now())
  
  @@index([userId])
}

// Modelo de Token de Reset de Senha
model PasswordResetToken {
  id          String    @id @default(cuid())
  token       String    @unique
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt   DateTime
  used        Boolean   @default(false)
  createdAt   DateTime  @default(now())
  
  @@index([userId])
}

// Modelo de Sessão
model Session {
  id          String    @id @default(cuid())
  token       String    @unique
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userAgent   String?
  ipAddress   String?
  expiresAt   DateTime
  createdAt   DateTime  @default(now())
  
  @@index([userId])
  @@index([token])
}

// Modelo de Presente/Página
model Gift {
  id            String    @id @default(cuid())
  slug          String    @unique
  title         String
  message       String    @db.Text
  theme         String    @default("elegance")
  font          String    @default("serif-luxe")
  animation     String    @default("fade-out")
  published     Boolean   @default(false)
  views         Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  photos        Photo[]
  musics        Music[]
  qrCode        QRCode?
}

// Modelo de Foto
model Photo {
  id            String    @id @default(cuid())
  url           String
  caption       String?
  order         Int
  createdAt     DateTime  @default(now())
  
  giftId        String
  gift          Gift      @relation(fields: [giftId], references: [id], onDelete: Cascade)
}

// Modelo de Música
model Music {
  id            String    @id @default(cuid())
  name          String
  artist        String?
  url           String
  duration      Int?
  createdAt     DateTime  @default(now())
  
  giftId        String
  gift          Gift      @relation(fields: [giftId], references: [id], onDelete: Cascade)
}

// Modelo de QR Code
model QRCode {
  id            String    @id @default(cuid())
  imageUrl      String
  customized    Boolean   @default(false)
  createdAt     DateTime  @default(now())
  
  giftId        String    @unique
  gift          Gift      @relation(fields: [giftId], references: [id], onDelete: Cascade)
}

// Modelo de Assinatura
model Subscription {
  id            String    @id @default(cuid())
  status        SubscriptionStatus @default(ACTIVE)
  startDate     DateTime  @default(now())
  endDate       DateTime?
  autoRenew     Boolean   @default(true)
  
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Enums
enum Plan {
  START
  PREMIUM
  ETERNAL
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
}
